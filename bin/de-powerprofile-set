#!/usr/bin/env sh

profile="$1"
profiles=$(powerprofilesctl list 2>/dev/null | grep -E "^\s*\*?\s*(performance|balanced|power-saver):" | sed 's/^\s*\*\?\s*//' | sed 's/:.*$//' | sed 's/^/  - /')

if [ -z "$profile" ]; then
    echo "Usage: $0 <performance|balanced|power-saver>"
    echo "Available profiles:"
    echo "$profiles"
    exit 1
fi

case "$profile" in
    performance|balanced|power-saver)
        if command -v powerprofilesctl &> /dev/null; then
            if ! powerprofilesctl set "$profile"; then
                exit 1
            fi
        else
            echo "Error: powerprofilesctl not found"
            exit 1
        fi
        ;;
    *)
        echo "Error: Invalid profile '$profile'"
        echo "Valid profiles:"
        echo "$profiles"
        exit 1
        ;;
esac
