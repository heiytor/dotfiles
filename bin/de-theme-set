#!/usr/bin/env sh

available_themes() {
    echo "Available themes:" >&2
    for theme in ~/themes/*; do
        if [[ -f "$theme" ]] || [[ -d "$theme" ]]; then
            theme_name=$(basename "$theme")
            if [[ "$theme_name" != "current" ]]; then
                echo "  * $theme_name" >&2
            fi
        fi
    done
}

if [[ -z "$1" ]]; then
    echo "Usage: theme-set <theme-name>" >&2
    available_themes
    exit 1
fi

THEMES_DIR="$HOME/themes"
THEMES_CURRENT_DIR="$HOME/themes/current"

THEME_NAME=$(echo "$1" | tr '[:upper:]' '[:lower:]' | tr ' ' '-')
THEME_PATH="$THEMES_DIR/$THEME_NAME"

if [[ ! -d "$THEME_PATH" ]]; then
    available_themes
    exit 1
fi

rm -rf "$THEMES_CURRENT_DIR"
ln -nsf "$THEME_PATH" "$THEMES_CURRENT_DIR"

# if [[ -f "$theme_dir/light.mode" ]]; then
#   echo "Applying light theme..."
#   gsettings set org.gnome.desktop.interface color-scheme "prefer-light"
#   gsettings set org.gnome.desktop.interface gtk-theme "Adwaita"
# else
#   echo "Applying dark theme..."
#   gsettings set org.gnome.desktop.interface color-scheme "prefer-dark"
#   gsettings set org.gnome.desktop.interface gtk-theme "Adwaita-dark"
# fi

# if [[ -f "$theme_dir/icons.theme" ]]; then
#   local icon_theme="$(<$theme_dir/icons.theme)"
#   gsettings set org.gnome.desktop.interface icon-theme "$icon_theme"
#   echo "Set icon theme: $icon_theme"
# fi

de-restart
echo "$THEME_NAME" > "$THEMES_DIR/current/name.txt"
