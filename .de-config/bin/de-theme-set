#!/usr/bin/env sh

available_themes() {
    echo "Available themes:" >&2
    for theme in ~/.de-config/themes/*; do
        if [[ -f "$theme" ]] || [[ -d "$theme" ]]; then
            theme_name=$(basename "$theme")
            if [[ "$theme_name" != "current" ]]; then
                echo "  * $theme_name" >&2
            fi
        fi
    done
}

if [[ -z "$1" ]]; then
    echo "Usage: theme-set <theme-name>" >&2
    available_themes
    exit 1
fi

THEMES_DIR="$HOME/.de-config/themes"
THEMES_CURRENT_DIR="$HOME/.de-config/themes/current"

THEME_NAME=$(echo "$1" | tr '[:upper:]' '[:lower:]' | tr ' ' '-')
THEME_PATH="$THEMES_DIR/$THEME_NAME"

if [[ ! -d "$THEME_PATH" ]]; then
    available_themes
    exit 1
fi

rm -rf "$THEMES_CURRENT_DIR"

ln -nsf "$THEME_PATH" "$THEMES_CURRENT_DIR"

mode=$(de-theme-get mode 2>/dev/null || echo "dark")
if [[ "$mode" == "light" ]]; then
    echo "Applying light theme..."
    gsettings set org.gnome.desktop.interface color-scheme "prefer-light"
    gsettings set org.gnome.desktop.interface gtk-theme "Adwaita"
elif [[ "$mode" == "dark" ]]; then
    echo "Applying dark theme..."
    gsettings set org.gnome.desktop.interface color-scheme "prefer-dark"
    gsettings set org.gnome.desktop.interface gtk-theme "Adwaita-dark"
else
    echo "Unknown mode '$mode', defaulting to dark theme..."
    gsettings set org.gnome.desktop.interface color-scheme "prefer-dark"
    gsettings set org.gnome.desktop.interface gtk-theme "Adwaita-dark"
fi

de-restart
