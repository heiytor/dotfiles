#!/usr/bin/env sh

if ! command -v powerprofilesctl &> /dev/null; then
    echo "Error: powerprofilesctl not found"
    exit 1
fi

current=$(powerprofilesctl get 2>/dev/null)
if [ -z "$current" ]; then
    echo "Error: Could not get current profile"
    exit 1
fi

case "$current" in
    performance) next_profile="balanced" ;;
    balanced) next_profile="power-saver" ;;
    power-saver) next_profile="performance" ;;
    *) next_profile="balanced" ;;
esac

if powerprofilesctl set "$next_profile"; then
    if [ "$1" = "notify" ]; then
        notify-send "Power Profile" "Changed: $current â†’ $next_profile"
    fi
else
    if [ "$1" = "notify" ]; then
        notify-send "Power Profile" "Failed to change"
    fi
    exit 1
fi
